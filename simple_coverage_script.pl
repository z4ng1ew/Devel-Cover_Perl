#!/usr/bin/perl
use strict;
use warnings;

# Очень простой скрипт для создания Markdown отчета
# Основан на выводе, который вы уже получили от Devel::Cover

print "Создаем простой Markdown отчет на основе известных данных...\n";

# Создаем Markdown файл
open my $md, '>', 'coverage.md' or die "Can't open coverage.md: $!";

print $md <<'EOF';
# Покрытие кода

## Сводка по покрытию

| Файл | Операторы | Ветвления | Условия | Подпрограммы | Время | Общее |
|------|-----------|-----------|---------|--------------|-------|-------|
| coverage_to_markdown.pl | 13.3% | 0.0% | 0.0% | n/a | 100.0% | 8.0% |

## Анализ результатов

### Операторы (Statements): 13.3%
- Выполнено небольшое количество строк кода
- Скрипт завершился с ошибкой на раннем этапе

### Ветвления (Branches): 0.0%
- Не было выполнено ни одного условного перехода
- Возможно, код не дошел до условных конструкций

### Условия (Conditions): 0.0%
- Не было проверено ни одного условия
- Логические выражения не выполнялись

### Подпрограммы (Subroutines): n/a
- Подпрограммы не были определены или не вызывались

### Общее покрытие: 8.0%
- Очень низкое покрытие из-за ранней ошибки в скрипте

## Рекомендации

1. **Исправить ошибки в коде** - основная причина низкого покрытия
2. **Добавить обработку ошибок** - для более стабильной работы
3. **Создать тесты** - для проверки различных сценариев
4. **Добавить логирование** - для отслеживания выполнения

## Технические детали

- База данных покрытия: `cover_db/`
- Инструмент анализа: Devel::Cover 1.36
- Типы анализа: branch, condition, statement, subroutine, time
- Pod coverage: недоступно (требуется Pod::Coverage)
EOF

close $md;

print "Markdown отчет создан: coverage.md\n";
print "Отчет содержит анализ на основе вывода Devel::Cover\n";

# Проверяем, что файл создался
if (-f 'coverage.md') {
    my $size = -s 'coverage.md';
    print "Размер файла: $size байт\n";
    
    # Показываем первые несколько строк
    print "\nПервые строки файла:\n";
    open my $check, '<', 'coverage.md';
    my $line_count = 0;
    while (my $line = <$check> and $line_count < 5) {
        print "  $line";
        $line_count++;
    }
    close $check;
}
